---
title: "Analysis"
format:
  html:
    toc: true
    toc-depth: 6
    toc-title: Contents
    toc-location: left
    toc-expand: 5
    smooth-scroll: true
    anchor-sections: true
    include-after-body: abbrv_toc.html
    number-sections: true
---

## Dataset 1 : The Percentage of Main Diseases/Health Problems Declared by Individuals in the Last 12 Months by Sex, 2016-2022 {toc-text="Dataset 1"}

```{r}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)

data_1 <- read_excel("tidydataset1.xls")
colnames(data_1) <- c("Diseases", "men_2016", "women_2016", "men_2019", "women_2019", "men_2022", "women_2022")

data_1_longer <- data_1 %>%
  pivot_longer(cols = starts_with(c("men", "women")),
               names_to = "Gender",
               values_to = "Percentage") %>%
  separate(Gender, into = c("Gender", "Year"), sep = "_") %>%
  arrange(Diseases) %>%
  mutate_at(vars(Year, Percentage), as.numeric) %>%
  mutate(Diseases = gsub("^\\n", "", Diseases))
```

### Average Percentage by Disease with Gender Connection {toc-text="Plot 1"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"

abbreviate_disease_names <- abbreviate(data_1_longer$Diseases)
ggplot(data_1_longer, aes(x = Diseases, y = Percentage, fill = Gender)) +
  geom_bar(stat = "summary", fun = "mean", position = "dodge", width = 0.7) +
  labs(title = "Average Percentage by Disease with Gender Connection",
       x = "Diseases",
       y = "Percentage") +
  scale_x_discrete(labels = abbreviate_disease_names) +
  scale_y_continuous(breaks = seq(0, 30, by = 5)) +
  scale_fill_manual(values = c("#99C2FF", "#FFB6C1")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

### Percentage by Disease with Year Connection {toc-text="Plot 2"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"

abbreviate_disease_names <- abbreviate(data_1_longer$Diseases)

custom_colors <- c("#66c2a5", "#fc8d62", "#8da0cb")

ggplot(data_1_longer, aes(x = Diseases, y = Percentage, fill = as.factor(Year))) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  labs(title = "Percentage by Disease with Year Connection",
       x = "Diseases",
       y = "Percentage",
       fill = "Year") +
  scale_x_discrete(labels = abbreviate_disease_names) +
  scale_y_continuous(breaks = seq(0, 35, by = 5)) +
  scale_fill_manual(values = custom_colors) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

### Distribution of Percentage by Gender for Each Disease {toc-text="Plot 3"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
abbreviate_disease_names <- abbreviate(data_1_longer$Diseases)

ggplot(data_1_longer, aes(x = reorder(abbreviate_disease_names, -Percentage), y = Percentage, fill = Gender)) +
  geom_boxplot(position = "dodge", alpha = 0.7) +
  labs(title = "Distribution of Percentage by Gender for Each Disease",
       x = "Abbreviated Diseases",
       y = "Percentage",
       fill = "Gender") +
  scale_fill_manual(values = c("#66c2a5", "#fc8d62")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.x = element_text(angle = 45, hjust = 1))
```

## Data Set 2 : The Percentage of Individuals' Status of Alcohol Use by Sex and Age Group, 2016-2022 {toc-text="Dataset 2"}

```{r}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)

data_2 <- read_excel("tidydataset2.xls")
colnames(data_2) <- c("age", "men_2016", "women_2016", "men_2019", "women_2019", "men_2022", "women_2022", "usage")
data_2_longer <- data_2 %>%
  pivot_longer(cols = starts_with(c("men", "women")),
               names_to = "gender",
               values_to = "rate") %>%
  separate(gender, into = c("gender", "year"), sep = "_") %>%
  arrange(age) %>%
  mutate_at(vars(year, rate), as.numeric) %>%
  na.omit()
```

### Alcohol Usage Rate Distribution by Age Group

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = age, y = rate, fill = gender)) +
  geom_boxplot() +
  labs(title = "Distribution of Alcohol Usage Rate by Age Group",
       x = "Age Group",
       y = "Rate") +
  scale_fill_manual(values = c("#99C2FF", "#FFB6C1")) +
  theme_minimal()
```

### Stripplot Showing Distribution of Alcohol Usage Rate by Age Group

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = age, y = rate, color = gender)) +
  geom_jitter(alpha = 0.7) +
  labs(title = "Distribution of Alcohol Usage Rate by Age Group",
       x = "Age Group",
       y = "Rate") +
  scale_color_manual(values = c("blue", "red")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_minimal()

```

### Distribution of Alcohol Usage Rates in Age Groups

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = rate, fill = age)) +
  geom_histogram(binwidth = 10, position = "dodge", alpha = 0.7) +
  labs(title = "Distribution of Alcohol Usage Rates in Age Groups",
       x = "Rate",
       y = "Count") +
  theme_minimal()
```

### Relationship Between Usage, Age Groups, and Years (Total)

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = year, y = rate, color = usage)) +
  geom_line(aes(group = usage), size = 1.5) +
  facet_grid(age ~ .) +
  labs(title = "Relationship between Usage, Age Groups, and Years (Total)",
       x = "Year",
       y = "Rate") +
  theme_minimal()
```

## Data Set 3 : Body Mass Index Distribution of Individuals by Sex, 2008-2022 {toc-text="Dataset 3"}

```{r}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
data_3 <- read_excel("tidydataset3.xls")
colnames(data_3) <- c("Year", "Sex", "Underweight", "Normal_weight", "Pre_Obese", "Obese")
data_3_long <- data_3 %>%
  pivot_longer(cols = c(Underweight, Normal_weight, Pre_Obese, Obese),
               names_to = "Category",
               values_to = "Percentage")
```

### Percentage of Categories Over Years {toc-text="Plot 1"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Year, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Categories Over Years",
       x = "Year",
       y = "Percentage") +
  theme_minimal()
```

### Percentage Trends Over Years {toc-text="Plot 2"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Year, y = Percentage, color = Category)) +
  geom_line() +
  labs(title = "Percentage Trends Over Years",
       x = "Year",
       y = "Percentage") +
  theme_minimal()
```

### Composition of Categories Over Years {toc-text="Plot 3"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Year, y = Percentage, fill = Category)) +
  geom_area() +
  labs(title = "Composition of Categories Over Years",
       x = "Year",
       y = "Percentage") +
  theme_minimal()
```

### Percentage of Categories by Gender {toc-text="Plot 4"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Sex, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Categories by Gender",
       x = "Gender",
       y = "Percentage") +
  theme_minimal()
```
