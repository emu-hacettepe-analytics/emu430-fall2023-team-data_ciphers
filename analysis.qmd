---
title: "Analysis"
format:
  html:
    toc: true
    toc-depth: 6
    toc-title: Contents
    toc-location: left
    toc-expand: 5
    smooth-scroll: true
    anchor-sections: true
    include-after-body: abbrv_toc.html
    number-sections: true
---

## Dataset 1 : The Percentage of Main Diseases/Health Problems Declared by Individuals in the Last 12 Months by Sex, 2016-2022 {toc-text="Dataset 1"}

```{r message=FALSE, warning=FALSE}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
library(plotly)

data_1 <- read_excel("tidydataset1.xls")
colnames(data_1) <- c("Diseases", "men_2016", "women_2016", "men_2019", "women_2019", "men_2022", "women_2022")

data_1_longer <- data_1 %>%
  pivot_longer(cols = starts_with(c("men", "women")),
               names_to = "Gender",
               values_to = "Percentage") %>%
  separate(Gender, into = c("Gender", "Year"), sep = "_") %>%
  arrange(Diseases) %>%
  mutate_at(vars(Year, Percentage), as.numeric) %>%
  mutate(Diseases = gsub("^\\n", "", Diseases))
```

### Average Percentage by Disease with Gender Connection {toc-text="Plot 1"}

```{r message=FALSE, warning=FALSE}
#| code-fold: true
#| code-summary: "Show the code"

summary_data <- data_1_longer %>%
  group_by(Diseases, Gender) %>%
  summarise(mean_percentage = mean(Percentage))
abbreviate_disease_names <- abbreviate(summary_data$Diseases)
plot <- plot_ly(summary_data, 
                x = ~abbreviate_disease_names, 
                y = ~mean_percentage, 
                color = ~Gender,
                colors = c("#1E7DFF", "#FC90FF"),
                type = "bar") %>%
  layout(title = list(text="Average Percentage by Disease with Gender Connection", x = 0, y = 1),
         xaxis = list(title = "Diseases",
                      zeroline = FALSE),
         yaxis = list(title = "Percentage",
                      zeroline = FALSE))
  
plot
```

### Percentage by Disease with Year Connection {toc-text="Plot 2"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"

abbreviate_disease_names <- abbreviate(data_1_longer$Diseases)

custom_colors <- c("#66c2a5", "#fc8d62", "#8da0cb")

ggplot(data_1_longer, aes(x = Diseases, y = Percentage, fill = as.factor(Year))) +
  geom_bar(stat = "identity", position = "dodge", width = 0.7) +
  labs(title = "Percentage by Disease with Year Connection",
       x = "Diseases",
       y = "Percentage",
       fill = "Year") +
  scale_x_discrete(labels = abbreviate_disease_names) +
  scale_y_continuous(breaks = seq(0, 35, by = 5)) +
  scale_fill_manual(values = custom_colors) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

### Distribution of Percentage by Gender for Each Disease {toc-text="Plot 3"}

```{r message=FALSE, warning=FALSE}
#| code-fold: true
#| code-summary: "Show the code"
aabbreviate_disease_names <- abbreviate(data_1_longer$Diseases)
p6 <- plot_ly(data_1_longer,
              x = ~reorder(abbreviate_disease_names, -Percentage),
              y = ~Percentage,
              color = ~Gender,
              colors = c("#1E7DFF", "#FC90FF"),
              type = "box") %>% 
  layout(boxmode = "group",
         title = "Distribution of Percentage by Gender for Each Disease",
         xaxis = list(title = "Diseases",
                      zeroline = FALSE),
         yaxis = list(title = "Percentage",
                      zeroline = FALSE))
p6
```

## Data Set 2 : The Percentage of Individuals' Status of Alcohol Use by Sex and Age Group, 2016-2022 {toc-text="Dataset 2"}

```{r}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)

data_2 <- read_excel("tidydataset2.xls")
colnames(data_2) <- c("age", "men_2016", "women_2016", "men_2019", "women_2019", "men_2022", "women_2022", "usage")
data_2_longer <- data_2 %>%
  pivot_longer(cols = starts_with(c("men", "women")),
               names_to = "gender",
               values_to = "rate") %>%
  separate(gender, into = c("gender", "year"), sep = "_") %>%
  arrange(age) %>%
  mutate_at(vars(year, rate), as.numeric) %>%
  na.omit()
```

### Alcohol Usage Rate Distribution by Age Group {toc-text="Plot 1"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = age, y = rate, fill = gender)) +
  geom_boxplot() +
  labs(title = "Distribution of Alcohol Usage Rate by Age Group",
       x = "Age Group",
       y = "Rate") +
  scale_fill_manual(values = c("#99C2FF", "#FFB6C1")) +
  theme_minimal()
```

### Strip Plot Showing Distribution of Alcohol Usage Rate by Age Group {toc-text="Plot 2"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = age, y = rate, color = gender)) +
  geom_jitter(alpha = 0.7) +
  labs(title = "Distribution of Alcohol Usage Rate by Age Group",
       x = "Age Group",
       y = "Rate") +
  scale_color_manual(values = c("#66c2a5", "#fc8d62")) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  theme_minimal()

```

### Distribution of Alcohol Usage Rates in Age Groups {toc-text="Plot 3"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_2_longer, aes(x = rate, fill = age)) +
  geom_histogram(binwidth = 10, position = "dodge", alpha = 0.7) +
  labs(title = "Distribution of Alcohol Usage Rates in Age Groups",
       x = "Rate",
       y = "Count") +
  theme_minimal()
```

### Usage Across Years by Gender {toc-text="Plot 4"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
custom_colors <- c("#fc8d62", "#8da0cb","#66c2a5")
ggplot(data_2_longer, aes(x = year, y = rate, fill = usage)) +
  geom_bar(stat = "identity", position = "dodge") +
  facet_grid(. ~ gender) +
  labs(title = "Usage Across Years by Gender",
       x = "Year",
       y = "Rate") +
  scale_y_continuous(breaks = seq(0, 35, by = 5)) +
  scale_fill_manual(values = custom_colors) +
  theme_minimal() 
 
```

## Data Set 3 : Body Mass Index Distribution of Individuals by Sex, 2008-2022 {toc-text="Dataset 3"}

```{r}
#| echo: false
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
data_3 <- read_excel("tidydataset3.xls")
colnames(data_3) <- c("Year", "Sex", "Underweight", "Normal_weight", "Pre_Obese", "Obese")
data_3_long <- data_3 %>%
  pivot_longer(cols = c(Underweight, Normal_weight, Pre_Obese, Obese),
               names_to = "Category",
               values_to = "Percentage")
```

### Percentage of Categories Over Years {toc-text="Plot 1"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
data_3 <- read_excel("tidydataset3.xls")
colnames(data_3) <- c("Year", "Sex", "Underweight", "Normal_weight", "Pre_Obese", "Obese")
data_3_long <- data_3 %>%
  pivot_longer(cols = c(Underweight, Normal_weight, Pre_Obese, Obese),
               names_to = "Category",
               values_to = "Percentage")

desired_years <- c(2008, 2010, 2012, 2014, 2016, 2019, 2022)

ggplot(data_3_long[data_3_long$Year >= 2008 & data_3_long$Year <= 2022, ], 
       aes(x = factor(Year, levels = desired_years), y = Percentage, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Categories (2008-2022)",
       x = "Year",
       y = "Percentage") +
  scale_x_discrete(labels = as.character(desired_years)) +
  theme_minimal()
```

### Composition of Categories Over Years {toc-text="Plot 3"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Year, y = Percentage, fill = Category)) +
  geom_area() +
  labs(title = "Composition of Categories Over Years",
       x = "Year",
       y = "Percentage") +
  theme_minimal()
```

### Percentage of Categories by Gender {toc-text="Plot 4"}

```{r}
#| code-fold: true
#| code-summary: "Show the code"
ggplot(data_3_long, aes(x = Sex, y = Percentage, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Categories by Gender",
       x = "Gender",
       y = "Percentage") +
  theme_minimal()
```

### Percentage of Categories (2008-2022)

```{r}
#| code-fold: true
#| code-summary: "Show the code"
suppressPackageStartupMessages(library(dplyr))
library(readxl)
library(dplyr)
library(tidyr)
library(ggplot2)
data_3 <- read_excel("tidydataset3.xls")
colnames(data_3) <- c("Year", "Sex", "Underweight", "Normal_weight", "Pre_Obese", "Obese")
data_3_long <- data_3 %>%
  pivot_longer(cols = c(Underweight, Normal_weight, Pre_Obese, Obese),
               names_to = "Category",
               values_to = "Percentage")

desired_years <- c(2008, 2010, 2012, 2014, 2016, 2019, 2022)

ggplot(data_3_long[data_3_long$Year >= 2008 & data_3_long$Year <= 2022, ], 
       aes(x = factor(Year, levels = desired_years), y = Percentage, fill = Category)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(title = "Percentage of Categories (2008-2022)",
       x = "Year",
       y = "Percentage") +
  scale_x_discrete(labels = as.character(desired_years)) +
  theme_minimal()



```
